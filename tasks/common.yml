---
# This sh/could be put in a separate role..
  - name: Add FGI slurm repo
    template: src=fgislurm.repo dest=/etc/yum.repos.d/fgislurm.repo owner=root group=root mode=0644 backup=yes

  - name: Import FGI slurm repo key
    rpm_key: key=http://idris.fgi.csc.fi/fgirepo6/RPM-GPG-KEY-CSC-GRID-2 state=present

##

  - name: install Slurm on non-compute nodes
    yum: name={{ item }} state=present
    with_items: slurm_packages
    when: slurm_type != "compute"

  - name: install Slurm on compute nodes
    yum: name={{ item }} state=present
    with_items: slurm_node_packages
    when: slurm_type == "compute"

  - name: pam.d/slurm
    copy: src=pam_slurm dest=/etc/pam.d/slurm owner=root mode=0644
 
  - name: slurm.conf
    template: src=slurm.conf.j2 dest=/etc/slurm/slurm.conf owner=root mode=0644
   
  - name: add slurm unix user
    user: name=slurm shell=/sbin/nologin createhome=no home=/nonexixtent system=yes append=yes
   
  - name: add slurm log dir
    file: path="/var/log/slurm" state=directory owner=slurm group=slurm mode=0750

  - name: add slurm tmp dir
    file: path="/tmp/slurmd" state=directory owner=slurm group=slurm mode=0750

  - name: add slurm tmp dir
    file: path="/tmp/slurmstate" state=directory owner=slurm group=slurm mode=0750


