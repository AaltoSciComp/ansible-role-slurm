---

#### Upgrade

  - name: Get version of installed slurm RPM
    shell: yum list installed slurm | grep slurm | awk '{print $2}' | cut -d'-' -f1
    register: reg_slurm_yum_version
    changed_when: False

  - name: Get version of installed slurm RPM major version
    shell: yum list installed slurm | grep slurm | awk '{print $2}' | cut -d'-' -f1|cut -d "." -f1-2
    register: reg_slurm_yum_version_major
    changed_when: False

  - name: Set fact with contents of fgci_slurmrepo_version with only the numbers
    set_fact: slurm_fact_fgci_slurmrepo_version="{{ fgci_slurmrepo_version | replace('fgcislurm', '')}}"

  - name: print custom facts in verbose mode
    debug: var=item verbosity=1
    with_items:
     - "{{ reg_slurm_yum_version }}"
     - "{{ slurm_fact_fgci_slurmrepo_version }}"
     - "{{Â reg_slurm_yum_version_major }}"

  - name: Pause if we are upgrading between major slurm versions on the dbd host
    pause: prompt="slurm is set to be upgraded on {{ ansible_hostname }}. This is a manual task. Press ENTER when the manual steps are done."
    when: (slurm_fact_fgci_slurmrepo_version != reg_slurm_yum_version_major) and (slurm_accounting_storage_host == ansible_hostname)
